def extract_malware_from_folder(folder_path):
    malware_list = []

    for filename in os.listdir(folder_path):
        file_path = os.path.join(folder_path, filename)
        if os.path.isfile(file_path):
            with open(file_path, 'r') as file:
                try:
                    json_data = json.load(file)
                    malware = extract_malware(json_data)
                    if malware:
                        malware_list.append(malware)
                except json.JSONDecodeError:
                    print(f"Error decoding JSON file: {file_path}")
                except KeyError:
                    print(f"Missing key in JSON file: {file_path}")

    return malware_list


def extract_malware(json_data):
    malware = None

    if 'objects' in json_data and isinstance(json_data['objects'], list):
        for obj in json_data['objects']:
            if obj.get('type') == 'malware':
                malware = {
                    'id': obj.get('id'),
                    'name': obj.get('name')
                }
                break

    return malware


# Example usage
folder_path = "F:\Projects\CTI\enterprise-attack\malware"
malware_objects = extract_malware_from_folder(folder_path)

for malware in malware_objects:
    print(f"ID: {malware['id']}, Name: {malware['name']}")
    
print(len(malware_objects))